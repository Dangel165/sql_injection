{% extends "base.html" %}

{% block title %}관리자 보고서 - SecureBank{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <!-- 헤더 -->
    <div class="row mb-4">
        <div class="col-md-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('admin_dashboard') }}">관리자 대시보드</a></li>
                    <li class="breadcrumb-item active">상세 보고서</li>
                </ol>
            </nav>
            <h2><i class="fas fa-chart-bar me-2"></i>SecureBank 상세 보고서</h2>
            <p class="lead text-muted">비즈니스 인텔리전스 및 데이터 분석</p>
        </div>
    </div>

    <!-- 보고서 필터 -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header bg-secondary text-white">
                    <h6><i class="fas fa-filter me-2"></i>보고서 필터</h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <label class="form-label">기간 선택</label>
                            <select class="form-select">
                                <option>최근 7일</option>
                                <option>최근 30일</option>
                                <option selected>최근 3개월</option>
                                <option>최근 1년</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">고객 유형</label>
                            <select class="form-select">
                                <option selected>전체</option>
                                <option>일반고객</option>
                                <option>VIP고객</option>
                                <option>기업고객</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">거래 유형</label>
                            <select class="form-select">
                                <option selected>전체</option>
                                <option>입금</option>
                                <option>출금</option>
                                <option>이체</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">&nbsp;</label>
                            <div class="d-grid">
                                <button class="btn btn-primary">
                                    <i class="fas fa-search me-2"></i>조회
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- 월별 가입자 통계 -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5><i class="fas fa-user-plus me-2"></i>월별 신규 가입자</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>월</th>
                                    <th>신규 가입자</th>
                                    <th>증감률</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for signup in monthly_signups %}
                                <tr>
                                    <td>{{ signup[0] }}</td>
                                    <td><strong>{{ signup[1] }}명</strong></td>
                                    <td>
                                        <span class="badge bg-success">
                                            <i class="fas fa-arrow-up me-1"></i>+15%
                                        </span>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- 간단한 차트 시뮬레이션 -->
                    <div class="mt-3">
                        <canvas id="signupChart" width="400" height="200" style="background: linear-gradient(45deg, #e3f2fd, #bbdefb); border-radius: 5px; padding: 20px;">
                            <div class="text-center py-4">
                                <i class="fas fa-chart-line fa-3x text-primary"></i>
                                <p class="mt-2 text-muted">월별 가입자 추이 차트</p>
                            </div>
                        </canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- 거래 유형별 통계 -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5><i class="fas fa-exchange-alt me-2"></i>거래 유형별 통계</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>거래 유형</th>
                                    <th>건수</th>
                                    <th>총 금액</th>
                                    <th>비율</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for stat in transaction_stats %}
                                <tr>
                                    <td>
                                        <span class="badge bg-{{ 'success' if stat[0] == 'deposit' else 'danger' }}">
                                            {{ '입금' if stat[0] == 'deposit' else '출금' }}
                                        </span>
                                    </td>
                                    <td><strong>{{ stat[1] }}건</strong></td>
                                    <td>₩{{ "{:,}".format(stat[2]) }}</td>
                                    <td>
                                        <div class="progress" style="height: 20px;">
                                            <div class="progress-bar bg-{{ 'success' if stat[0] == 'deposit' else 'danger' }}" 
                                                 style="width: {% if stat[0] == 'deposit' %}60{% else %}40{% endif %}%">
                                                {% if stat[0] == 'deposit' %}60{% else %}40{% endif %}%
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <!-- 도넛 차트 시뮬레이션 -->
                    <div class="text-center mt-3">
                        <div style="width: 200px; height: 200px; border-radius: 50%; background: conic-gradient(#28a745 0deg 180deg, #dc3545 180deg 360deg); margin: 0 auto; position: relative;">
                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; width: 100px; height: 100px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <div class="text-center">
                                    <small class="text-muted">총 거래</small><br>
                                    <strong>{{ transaction_stats|length }}건</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 잔액 분포 -->
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h5><i class="fas fa-chart-pie me-2"></i>고객 잔액 분포</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% for balance in balance_distribution %}
                        <div class="col-md-3">
                            <div class="card bg-light">
                                <div class="card-body text-center">
                                    <h4 class="text-primary">{{ balance[1] }}명</h4>
                                    <p class="mb-0">{{ balance[0] }}</p>
                                    <div class="progress mt-2">
                                        <div class="progress-bar bg-info" 
                                             style="width: {% if loop.index == 1 %}45{% elif loop.index == 2 %}30{% elif loop.index == 3 %}20{% else %}5{% endif %}%">
                                        </div>
                                    </div>
                                    <small class="text-muted">{% if loop.index == 1 %}45{% elif loop.index == 2 %}30{% elif loop.index == 3 %}20{% else %}5{% endif %}%</small>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 상세 분석 -->
    <div class="row mt-4">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-warning text-dark">
                    <h5><i class="fas fa-microscope me-2"></i>상세 분석 리포트</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6><i class="fas fa-trophy me-2 text-warning"></i>주요 성과 지표</h6>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-check text-success me-2"></i>고객 만족도: 98.5%</li>
                                <li><i class="fas fa-check text-success me-2"></i>시스템 가동률: 99.9%</li>
                                <li><i class="fas fa-check text-success me-2"></i>보안 사고: 0건</li>
                                <li><i class="fas fa-check text-success me-2"></i>평균 응답시간: 0.2초</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="fas fa-exclamation-triangle me-2 text-warning"></i>주의 사항</h6>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-info-circle text-info me-2"></i>대용량 거래 증가 추세</li>
                                <li><i class="fas fa-info-circle text-info me-2"></i>모바일 접속 비율 상승</li>
                                <li><i class="fas fa-info-circle text-info me-2"></i>신규 보안 정책 필요</li>
                                <li><i class="fas fa-info-circle text-info me-2"></i>서버 용량 확장 검토</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card">
                <div class="card-header bg-danger text-white">
                    <h6><i class="fas fa-download me-2"></i>보고서 내보내기</h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-success">
                            <i class="fas fa-file-excel me-2"></i>Excel 파일
                        </button>
                        <button class="btn btn-outline-danger">
                            <i class="fas fa-file-pdf me-2"></i>PDF 파일
                        </button>
                        <button class="btn btn-outline-primary">
                            <i class="fas fa-file-powerpoint me-2"></i>PowerPoint
                        </button>
                        <button class="btn btn-outline-info">
                            <i class="fas fa-envelope me-2"></i>이메일 발송
                        </button>
                    </div>
                </div>
            </div>

            <div class="card mt-3">
                <div class="card-header bg-secondary text-white">
                    <h6><i class="fas fa-clock me-2"></i>자동 보고서</h6>
                </div>
                <div class="card-body">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" checked>
                        <label class="form-check-label">일일 보고서</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" checked>
                        <label class="form-check-label">주간 보고서</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox">
                        <label class="form-check-label">월간 보고서</label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 하단 버튼 -->
    <div class="row mt-4 mb-4">
        <div class="col-md-12 text-center">
            <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary me-2">
                <i class="fas fa-arrow-left me-2"></i>관리자 대시보드로 돌아가기
            </a>
            <button class="btn btn-primary me-2">
                <i class="fas fa-sync-alt me-2"></i>데이터 새로고침
            </button>
            <button class="btn btn-success">
                <i class="fas fa-share-alt me-2"></i>보고서 공유
            </button>
        </div>
    </div>
</div>
{% endblock %}